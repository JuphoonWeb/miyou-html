<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
	<title>2.学生证信息</title>
	<style>
		*{
			padding:0;margin:0;
			box-sizing: border-box;
			font-family: 'Heiti SC';
			font-size: 16px;
		}
		.upload{
			position: relative;
			width:100%;
			border-radius: 8px;
			padding-top: 37px;
			text-align: center;
		}
		.upload .title{
			margin-bottom: 20px;
			color:rgb(255, 168, 11);
		}
		.upload img{
			width:310px;
			height:190px;
			border-radius: 8px;
		}
		#image-upload-1,#upload-btn{
			position: absolute;
			top:226px;left:118px;
			width:135px;
			height:28px;
		}
		input[type="file"]#image-upload-1{
			z-index:100;
			opacity: 0;
		}
		#upload-btn{
			z-index:99;
			line-height: 28px;
			color:rgb(255, 255, 255);
			background-color: rgb(255, 173, 26);
			border:none;
			border-radius: 41px;
		}
		#upload-2{
			position:relative;
			width: 310px;
			height:190px;
			margin:20px 33px;
			border-radius:8px;
		}
		#upload-2 img#image-example-2{
			position: absolute;
			top:0;left:0;
			width:100%;height:100%;
			border-radius: 8px;
			z-index:-1;
			margin: 0;
		}
		#upload-2 img{
			width:54px;
			height:43px;
			margin:50px 129px 0px;
		}

		#upload-2 .info-text{
			margin:0 auto;
			width:176px;
			text-align: center;
			color:rgb(255, 168, 11);
		}
		#upload-2 #image-upload-2{
			position:absolute;
			top:0;left:0;
			width:100%;height:100%;
			opacity: 0;
			z-index:100;
		}

		.btn-container{
			width:120px;
			height:50px;
			margin:30px auto 0;
			color:rgb(255, 255, 255);
			font-size:18px;
			text-align: center;
			background-image: url(img/btnOkDis.png);

		}
		.btn-container p{
			height: 45px;
			line-height: 45px;
		}
	</style>
</head>
<body>
	<div class="container">
		<form action="">
			<div class="upload" id="upload-1">
				<p class="title">手持学生证照片及个人信息页</p>
				<img id="image-example-1" src="img/imgExample.png" alt="">
				<button id="upload-btn">点击上传照片</button>
				<input type="file" id="image-upload-1" accept="image/*">
			</div>
			<div id="upload-2">
				<img src="img/imgAddBg.png" id="image-example-2" alt="">
				<div class="info" id="info-container">
					<img id="info-image" src="img/icBtnPhotograph.png" alt="">
					<p class="info-text">照片和信息不在同一页？可点击此处继续添加
					</p>
				</div>
				<input type="file" accept="image/*" id="image-upload-2">
			</div>
			<div class="btn-container" id="submit"><p>提交</p></div>
		</form>
	</div>
	<script src="js/zepto.min.js"></script>
	<script src="js/ajax.js"></script>
	<script src="js/cookie.js"></script>
	<script>

		var data = JSON.parse(getCookie('data'))
		data.phone = ''

		function getObjectURL(file){
			var url = null;
		    if (window.createObjectURL != undefined) { // basic
		        url = window.createObjectURL(file);
		    } else if (window.URL != undefined) { // mozilla(firefox)
		        url = window.URL.createObjectURL(file);
		    } else if (window.webkitURL != undefined) { // webkit or chrome
		        url = window.webkitURL.createObjectURL(file);
		    }
		    return url;
		}

		$('#image-upload-1').change(function(){
			var fileInput = $('#image-upload-1')[0];
			var file = fileInput.files[0]
			console.log('file',file)
			var imgUrl = getObjectURL(file)
			console.log('url', imgUrl)
			$('#image-example-1').attr('src', imgUrl)
			$('#upload-btn').hide()
			
			$('#submit').css('background-image','url(img/btnOkNor.png)')
			$('#submit').click(function(e){
				e.preventDefault()
				ajax({
					url: 'upload/authStudent',
					type: 'post',
					data: data,
					success (){

					},
					error (){

					}
				})
			})


			var form = new FormData()
			form.append('file',file)
			ajax({
					url: 'upload/studentImage',
					type: 'post',
					data: form,
					cache: false,
					processData: false,
				    contentType: false,
					success (response){
						if(response.code === 1){
							
							data.stuCardUrl = response.data 
						}
					},
					error () {

					}
				})	
		})

		$('#image-upload-2').change(function(){
			var fileInput = $('#image-upload-2')[0];
			var file = fileInput.files[0]
			console.log(file)
			var imgUrl = getObjectURL(file)
			console.log('url', imgUrl)
			$('#image-example-2').attr('src', imgUrl)	
			$('#info-container').hide()
			var form = new FormData()
			form.append('file',file)

			ajax({
					url: 'upload/studentImage',
					type: 'post',
					data: form,
					cache: false,
					processData: false,
				    contentType: false,
					success (response){
						if(response.code === 1){
							
							data.identityUrl = response.data 
						}
					},
					error () {

					}
				})
		})
		

	</script>
</body>
</html>