<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="Bookmark" href="/favicon.ico" >
    <link rel="Shortcut Icon" href="/favicon.ico" />
    <!--[if lt IE 9]>
    <script type="text/javascript" src="lib/html5shiv.js"></script>
    <script type="text/javascript" src="lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />

    <script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>

    <title>福利</title>
</head>
<body>
<article class="page-container">
    <form action="" method="post" class="form form-horizontal" id="form-member-add">
        <input type="hidden" id="id" name="id">
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">福利名：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" id="welfareName" name="welfareName">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">福利产品编号：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" id="welfareProId" name="welfareProId">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">福利产品名：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" id="welfareProName" name="welfareProName">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">描述：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" id="welfareDesc" name="welfareDesc">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">福利任务：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" id="welfareTask" name="welfareTask">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">福利开始时间：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="input-text" id="startTime" name="startTime" onclick="WdatePicker()" style="cursor: pointer" data-time=""></div>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">福利结束时间：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="input-text" id="endTime" name="endTime" onclick="WdatePicker()" style="cursor: pointer" data-time=" 23:59:59"></div>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3">福利规则：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <textarea name="welfareRole" id="welfareRole" cols="30" rows="10" class="input-text" style="height: 100px"></textarea>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-3"></label>
            <div class="formControls col-xs-8 col-sm-9" style="margin-top: 3px">
                特殊标签：
                <br>换行&lt;br&gt; &nbsp; 例如：我是第一行&lt;br&gt; &nbsp;我是第二行
                <br>着重&lt;i&gt;&lt;/i&gt; &nbsp; 例如：我是&lt;i&gt;着重突出&lt;/i&gt;的文案
            </div>
        </div>

        <div class="row cl">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                <input id="submit" class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
            </div>
        </div>
    </form>

</article>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>

<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="static/js/cookie.js"></script>
<script type="text/javascript" src="static/js/ajax.js"></script>
<script>
    Date.prototype.Format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };
    var hash = window.location.hash;
    //如果是编辑则会带参数
    if(hash){
        var string = decodeURI(hash).split('#')[1],
            data = JSON.parse(string);
        $.each($('.input-text'),function(index,ele){
            var ele = $(ele);
            if(ele.is('input')){
                ele.val(data[ele.attr('name')]);
            }
            else if(ele.is('div')){
                if(ele.attr('name')=='endTime'){
                    ele.text(new Date(data[ele.attr('name')]-1).Format("yyyy-MM-dd"));
                }else {
                    ele.text(new Date(data[ele.attr('name')]).Format("yyyy-MM-dd"));
                }
            }
        });
        $('#id').val(data.id);
    }

    $('#submit').click(function(event){
        event.preventDefault();
        var indata = {};
        $.each($('.input-text'),function(index,ele){
            var ele = $(ele);
            if(ele.is('input')){
                if(ele.val()==''){
                    $.Huimodalalert('请输入完整福利信息',2000);
                    return false;
                }
                indata[ele.attr('name')] = ele.val();
            }
            else if(ele.is('div')){
                if(ele.text()==''){
                    $.Huimodalalert('请选择对应福利时间',2000);
                    return false;
                }
                indata[ele.attr('name')] = ele.text()+ele.attr('data-time');
            }
        });
        if(Object.keys(indata).length!=8)return false;
        if(hash){
            indata.id = $('#id').val();
            ajax({
                url: 'admin/welfare/updateWelfare',
                method: 'post',
                data:indata,
                successFunc:function (data) {
                    if(data.code == 1){
                        layer.msg('保存成功');
                        setTimeout(function(){
                            parent.location.reload()
                        },2000)
                    }
                }
            });
        }else{
            ajax({
                url: 'admin/welfare/addWelfare',
                method: 'post',
                data:indata,
                successFunc:function (data) {
                    if(data.code == 1){
                        layer.msg('保存成功');
                        setTimeout(function(){
                            parent.location.reload()
                        },2000)
                    }
                }
            });
        }
    })
</script>

</body>
</html>